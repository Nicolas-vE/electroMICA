.. _faq:

Frequently Asked Questions
===========================

General
-------

**What is electroMICA?**
   `electroMICA` is a Python tool for projecting electrophysiological features 
   (scalp EEG, intracranial EEG) onto cortical and hippocampal surfaces generated by `micapipe`.
   It uses boundary element method (BEM) computations to map electrode data to brain surfaces.

**Do I need to run micapipe first?**
   Yes. `electroMICA` depends on `micapipe` outputs (T1w image, cortical surfaces, transforms).
   Run `micapipe` on your structural MRI first, then use `electroMICA`.

**Can I use electroMICA without electrode data?**
   For iEEG: No.
   For scalp EEG: Only for channels involving electrodes of the 10-10 or 10-20 position systems.

**What electrode types does electroMICA support?**
   - **iEEG**: Depth electrodes, modeled as line segments.
   - **Scalp EEG**: Standard 10-20, 10-10, or custom electrode montages.


Installation & Setup
--------------------

**I'm getting an "ImportError: No module named 'ants'"**
   Install `antspyx`:

   .. code-block:: bash

      pip install antspyx

   If that fails, try conda:

   .. code-block:: bash

      conda install -c conda-forge antspyx

**My nibabel version is too old. How do I update?**
   .. code-block:: bash

      pip install --upgrade nibabel

**How do I verify my installation?**
   .. code-block:: bash

      python -c "import electroMICA; print('OK')"

Data Preparation
-----------------

**What if my electrode labels don't match BIDS channels.tsv?**
   If there are mismatches, `electroMICA` will warn and skip unmatched channels.

Running electroMICA
-------------------

**Can I run electroMICA in parallel across subjects?**
   Yes! Each subject is independent. Use joblib, multiprocessing, or submit separate jobs to a cluster.


Troubleshooting
---------------

**"FileNotFoundError: No electrodes.tsv found"**
   Ensure your BIDS iEEG folder contains an `electrodes.tsv` file with the expected naming convention.
   Check: ``<BIDS_folder>/<sub>/[ses]/ieeg/*_electrodes.tsv``

**"No matching surface files found"**
   Ensure `micapipe` outputs are in the expected location:
   ``<micapipe_derivatives>/<sub>/[ses]/surf/*_surf-*.gii``

   Common issues:
   - Typo in folder path
   - Missing `micapipe` run for this subject
   - Different subject/session naming

**"Transform file not found"**
   If using electrode registration, ensure transform files are present:
   ``<micapipe_derivatives>/<sub>/[ses]/xfm/*_to_nativepro.mat``

**Can I compare maps across subjects?**
   Yes, they are in a common surface (e.g., ``fsLR-32k``). You can:
   - Average maps across subjects
   - Perform group statistics

Contributing & Support
----------------------

**How do I report a bug?**
   Open an issue on GitHub: [electroMICA GitHub](https://github.com/MICA-MNI/electroMICA/issues)

**How do I contribute code?**
   See :ref:`contributing` for contribution guidelines.

**Where can I get more help?**
   - Read the :ref:`algorithm` section for mathematical details
   - Check the :ref:`api` reference for function parameters
   - Open a GitHub discussion or issue

**Can electroMICA be used for clinical purposes?**
   `electroMICA` is a research tool. Regulatory approval or validation for clinical use 
   is not currently in place. Use in research only.
